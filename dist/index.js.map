{
  "version": 3,
  "sources": ["../src/toolbox.js", "../src/persistence.js", "../src/index.js"],
  "sourcesContent": ["// greatest common denominator\nfunction gcd (a, b) {\n  return b ? gcd(b, a % b) : a\n}\n\n// gcd for n elements\nfunction gcdOfList (ary) {\n  return ary.reduce((acc, v) => gcd(acc, v))\n}\n\n// create a list with test candidate that respects the selection chances\nfunction getCandidates (variations) {\n  let names = []\n  let chances = []\n\n  if (typeof variations === 'undefined' || typeof variations === 'string') {\n    console.error('VueAB: variations must be Array || Object')\n  }\n  else if (Array.isArray(variations)) { // assume list of VNodes\n    variations.forEach(v => {\n      if (v.data && v.data.slot) {\n        const chanceAttr = v.data.attrs ? v.data.attrs.chance : NaN\n        const chance = parseInt(chanceAttr) || 1\n        names.push(v.data.slot)\n        chances.push(chance)\n      }\n    })\n  }\n  else if (variations !== null && typeof variations === 'object') {\n    // assume name:chance object\n    Object.keys(variations).forEach(k => {\n      names.push(k)\n      chances.push(parseInt(variations[k]) || 1)\n    })\n  }\n\n  const divisor = chances.length ? gcdOfList(chances) : 1\n\n  return names.reduce((result, name, i) => {\n    const n = Math.round(chances[i] / divisor)\n    for (let i = 0; i < n; i++) result.push(name)\n    return result\n  }, [])\n}\n\n// return random element of array\nexport function pickRandomlyFrom (array) {\n  const index = Math.floor(Math.random() * array.length)\n  return array[index]\n}\n\n// pick a random candidate respecting the selection chances\nexport function randomCandidate (variations) {\n  const candidates = getCandidates(variations)\n  return pickRandomlyFrom(candidates)\n}\n\nfunction daysToMicroSeconds (days) {\n  return days * 24 * 3600 * 1000\n}\n\nexport function getCookie (name) {\n  const entries = document.cookie.split(';')\n  const len = name.length\n\n  for (const i in entries) {\n    const entry = entries[i].trim()\n\n    if (entry.substr(0, len) === name) {\n      const value = decodeURIComponent( entry.slice(len + 1) )\n      return JSON.parse(value)\n    }\n  }\n}\n\nexport function writeCookie (name, data, expiry) {\n  const d = new Date()\n  d.setTime(d.getTime() + daysToMicroSeconds(expiry))\n\n  const options = `expires=${d.toUTCString()};path=/`\n  data = encodeURIComponent(JSON.stringify(data))\n  document.cookie = `${name}=${data};${options}`\n}\n\nexport function getLocalStorage (name, expiry) {\n  const d = new Date()\n  d.setTime(d.getTime() + daysToMicroSeconds(expiry))\n  const entry = JSON.parse(localStorage.getItem(name))\n\n  return entry && entry.expires > d.getTime() ? entry : null\n}\n\nexport function writeLocalStorage (name, value, expiry) {\n  value.expiry = new Date().getTime() + daysToMicroSeconds(expiry)\n  localStorage.setItem(name, JSON.stringify(value))\n}\n", "import {\n  getCookie, writeCookie,\n  getLocalStorage, writeLocalStorage,\n  randomCandidate\n} from './toolbox'\n\nexport const storage = {\n  _store: null,\n  name: 'split-test', // name of cookie or localStorage entry\n  method: 'cookie',   // supported methods are 'cookie' and 'localStorage'\n  expiry: 30,         // ignore entries that weren't touched this amount of days\n\n  _load () {\n    if (this.method === 'cookie')\n      this._store = getCookie(this.name) || {}\n    else if (this.method === 'localStorage')\n      this._store = getLocalStorage(this.name, this.expiry) || {}\n    else {\n      console.warn(\"VueA2B WARNING: No or invalid storage method. Data will not persist.\")\n      this._store = {}\n    }\n    return this._store\n  },\n\n  _save () {\n    if (this.method === 'cookie')\n      writeCookie(this.name, this._store, this.expiry)\n    else if (this.method === 'localStorage')\n      writeLocalStorage(this.name, this._store, this.expiry)\n  },\n\n  get entry () {\n    return this._store || this._load()\n  },\n\n  set entry ({name, winner}) {\n    // avoid writing to non-existing storage when using \"always\" parameter\n    // see https://github.com/nkoehring/vue-a2b/pull/12\n    if (this._store === null) this._load()\n    this._store[name] = winner\n    this._save()\n  }\n}\n\nexport const selectAB = (name, variants) => {\n  const winner = storage.entry[name] || randomCandidate(variants)\n  storage.entry = {name, winner}\n  return winner\n}\n\n", "import { storage, selectAB } from './persistence'\nimport { randomCandidate } from './toolbox'\n\nconst VueAB = {\n  abtest: selectAB,\n  randomCandidate,\n  install (Vue, options = {}) {\n    if (options.storage) {\n      const cfg = options.storage\n      if (cfg.name) storage.name = cfg.name\n      if (cfg.method) storage.method = cfg.method\n      if (cfg.expiry) storage.expiry = parseInt(cfg.expiry)\n    }\n\n    Vue.component(options.component || 'split-test', {\n      functional: true,\n      props: {\n        always: String,\n        name: String\n      },\n      render (h, ctx) {\n        const name = ctx.props.name || ctx.parent.$options.name\n        if (!name) throw 'VueA2B Error: The test name is mandatory!'\n\n        const variations = ctx.slots()\n        const winner = ctx.props.always\n          || storage.entry[name]\n          || randomCandidate(ctx.children)\n\n        storage.entry = {name, winner}\n        return variations[winner]\n      }\n    })\n\n    Vue.mixin({\n      beforeCreate () {\n        this.$abtest = selectAB\n      }\n    })\n  }\n}\n\nexport default VueAB\n"],
  "mappings": "MACA,WAAc,EAAG,EAAG,CAClB,MAAO,GAAI,EAAI,EAAG,EAAI,GAAK,EAI7B,WAAoB,EAAK,CACvB,MAAO,GAAI,OAAO,CAAC,EAAK,IAAM,EAAI,EAAK,IAIzC,WAAwB,EAAY,CAClC,GAAI,GAAQ,GACR,EAAU,GAEd,AAAI,MAAO,IAAe,aAAe,MAAO,IAAe,SAC7D,QAAQ,MAAM,6CAEX,AAAI,MAAM,QAAQ,GACrB,EAAW,QAAQ,GAAK,CACtB,GAAI,EAAE,MAAQ,EAAE,KAAK,KAAM,CACzB,GAAM,GAAa,EAAE,KAAK,MAAQ,EAAE,KAAK,MAAM,OAAS,IAClD,EAAS,SAAS,IAAe,EACvC,EAAM,KAAK,EAAE,KAAK,MAClB,EAAQ,KAAK,MAIV,IAAe,MAAQ,MAAO,IAAe,UAEpD,OAAO,KAAK,GAAY,QAAQ,GAAK,CACnC,EAAM,KAAK,GACX,EAAQ,KAAK,SAAS,EAAW,KAAO,KAI5C,GAAM,GAAU,EAAQ,OAAS,EAAU,GAAW,EAEtD,MAAO,GAAM,OAAO,CAAC,EAAQ,EAAM,IAAM,CACvC,GAAM,GAAI,KAAK,MAAM,EAAQ,GAAK,GAClC,OAAS,GAAI,EAAG,EAAI,EAAG,IAAK,EAAO,KAAK,GACxC,MAAO,IACN,IAIE,WAA2B,EAAO,CACvC,GAAM,GAAQ,KAAK,MAAM,KAAK,SAAW,EAAM,QAC/C,MAAO,GAAM,GAIR,WAA0B,EAAY,CAC3C,GAAM,GAAa,EAAc,GACjC,MAAO,GAAiB,GAG1B,WAA6B,EAAM,CACjC,MAAO,GAAO,GAAK,KAAO,IAGrB,WAAoB,EAAM,CAC/B,GAAM,GAAU,SAAS,OAAO,MAAM,KAChC,EAAM,EAAK,OAEjB,OAAW,KAAK,GAAS,CACvB,GAAM,GAAQ,EAAQ,GAAG,OAEzB,GAAI,EAAM,OAAO,EAAG,KAAS,EAAM,CACjC,GAAM,GAAQ,mBAAoB,EAAM,MAAM,EAAM,IACpD,MAAO,MAAK,MAAM,KAKjB,WAAsB,EAAM,EAAM,EAAQ,CAC/C,GAAM,GAAI,GAAI,MACd,EAAE,QAAQ,EAAE,UAAY,EAAmB,IAE3C,GAAM,GAAU,WAAW,EAAE,uBAC7B,EAAO,mBAAmB,KAAK,UAAU,IACzC,SAAS,OAAS,GAAG,KAAQ,KAAQ,IAGhC,WAA0B,EAAM,EAAQ,CAC7C,GAAM,GAAI,GAAI,MACd,EAAE,QAAQ,EAAE,UAAY,EAAmB,IAC3C,GAAM,GAAQ,KAAK,MAAM,aAAa,QAAQ,IAE9C,MAAO,IAAS,EAAM,QAAU,EAAE,UAAY,EAAQ,KAGjD,WAA4B,EAAM,EAAO,EAAQ,CACtD,EAAM,OAAS,GAAI,QAAO,UAAY,EAAmB,GACzD,aAAa,QAAQ,EAAM,KAAK,UAAU,ICxFrC,GAAM,GAAU,CACrB,OAAQ,KACR,KAAM,aACN,OAAQ,SACR,OAAQ,GAER,OAAS,CACP,MAAI,MAAK,SAAW,SAClB,KAAK,OAAS,EAAU,KAAK,OAAS,GACnC,AAAI,KAAK,SAAW,eACvB,KAAK,OAAS,EAAgB,KAAK,KAAM,KAAK,SAAW,GAEzD,SAAQ,KAAK,wEACb,KAAK,OAAS,IAET,KAAK,QAGd,OAAS,CACP,AAAI,KAAK,SAAW,SAClB,EAAY,KAAK,KAAM,KAAK,OAAQ,KAAK,QAClC,KAAK,SAAW,gBACvB,EAAkB,KAAK,KAAM,KAAK,OAAQ,KAAK,YAG/C,QAAS,CACX,MAAO,MAAK,QAAU,KAAK,YAGzB,OAAO,CAAC,OAAM,UAAS,CAGzB,AAAI,KAAK,SAAW,MAAM,KAAK,QAC/B,KAAK,OAAO,GAAQ,EACpB,KAAK,UAII,EAAW,CAAC,EAAM,IAAa,CAC1C,GAAM,GAAS,EAAQ,MAAM,IAAS,EAAgB,GACtD,SAAQ,MAAQ,CAAC,OAAM,UAChB,GC5CT,GAAM,GAAQ,CACZ,OAAQ,EACR,kBACA,QAAS,EAAK,EAAU,GAAI,CAC1B,GAAI,EAAQ,QAAS,CACnB,GAAM,GAAM,EAAQ,QACpB,AAAI,EAAI,MAAM,GAAQ,KAAO,EAAI,MAC7B,EAAI,QAAQ,GAAQ,OAAS,EAAI,QACjC,EAAI,QAAQ,GAAQ,OAAS,SAAS,EAAI,SAGhD,EAAI,UAAU,EAAQ,WAAa,aAAc,CAC/C,WAAY,GACZ,MAAO,CACL,OAAQ,OACR,KAAM,QAER,OAAQ,EAAG,EAAK,CACd,GAAM,GAAO,EAAI,MAAM,MAAQ,EAAI,OAAO,SAAS,KACnD,GAAI,CAAC,EAAM,KAAM,4CAEjB,GAAM,GAAa,EAAI,QACjB,EAAS,EAAI,MAAM,QACpB,EAAQ,MAAM,IACd,EAAgB,EAAI,UAEzB,SAAQ,MAAQ,CAAC,OAAM,UAChB,EAAW,MAItB,EAAI,MAAM,CACR,cAAgB,CACd,KAAK,QAAU,OAMhB,EAAQ",
  "names": []
}
